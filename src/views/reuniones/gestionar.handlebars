{{#if success}}
<div class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle"></i> {{success}}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{{/if}}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
        <i class="bi bi-gear"></i> Gestionar Reuniones
    </h1>
    <a href="/reuniones/new" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> Nueva Reunión
    </a>
</div>

{{#if reuniones.length}}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Título</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Duración</th>
                {{#if (eq usuario.rol "admin")}}
                <th>Vendedor</th>
                {{/if}}
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {{#each reuniones}}
            <tr>
                <td>{{this.titulo}}</td>
                <td>{{formatDate this.fecha}}</td>
                <td>{{this.hora}}</td>
                <td>{{this.duracion}} min</td>
                {{#if (eq ../usuario.rol "admin")}}
                <td>{{this.vendedor.nombre}}</td>
                {{/if}}
                <td>
                    {{#if (eq this.estado "programada")}}
                    <span class="badge bg-primary">{{formatEstado this.estado}}</span>
                    {{else if (eq this.estado "en_curso")}}
                    <span class="badge bg-warning">{{formatEstado this.estado}}</span>
                    {{else if (eq this.estado "finalizada")}}
                    <span class="badge bg-success">{{formatEstado this.estado}}</span>
                    {{else}}
                    <span class="badge bg-danger">{{formatEstado this.estado}}</span>
                    {{/if}}
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <a href="/reuniones/{{this.id}}" class="btn btn-sm btn-info" title="Ver">
                            <i class="bi bi-eye"></i>
                        </a>
                        <a href="/reuniones/{{this.id}}/participantes" class="btn btn-sm btn-primary"
                            title="Ver Cliente">
                            <i class="bi bi-person"></i>
                        </a>
                        <a href="/reuniones/{{this.id}}/edit" class="btn btn-sm btn-warning" title="Editar">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal"
                            data-bs-target="#deleteModal{{this.id}}" title="Eliminar">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>

                    <!-- Modal de confirmación -->
                    <div class="modal fade" id="deleteModal{{this.id}}" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Confirmar Eliminación</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    ¿Estás seguro de eliminar la reunión "<strong>{{this.titulo}}</strong>"?
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Cancelar</button>
                                    <form action="/reuniones/{{this.id}}?_method=DELETE" method="POST"
                                        style="display: inline;">
                                        <button type="submit" class="btn btn-danger">Eliminar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {{/each}}
        </tbody>
    </table>
</div>
{{else}}
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> No has creado ninguna reunión todavía.
</div>
{{/if}}