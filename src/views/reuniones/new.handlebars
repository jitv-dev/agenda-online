<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0">
                    <i class="bi bi-plus-circle"></i> Crear Nueva Reunión
                </h3>
            </div>
            <div class="card-body">
                <form action="/reuniones" method="POST" id="formReunion">
                    <!-- Tipo de Reunión -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">Tipo de Reunión</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="esPrivada" id="reunionPublica"
                                value="false" checked onchange="toggleClienteSelector()">
                            <label class="form-check-label" for="reunionPublica">
                                <i class="bi bi-globe"></i> <strong>Pública</strong>
                                <small class="d-block text-muted">Los clientes pueden encontrarla y agendarla</small>
                            </label>
                        </div>
                        <div class="form-check mt-2">
                            <input class="form-check-input" type="radio" name="esPrivada" id="reunionPrivada"
                                value="true" onchange="toggleClienteSelector()">
                            <label class="form-check-label" for="reunionPrivada">
                                <i class="bi bi-lock"></i> <strong>Privada</strong>
                                <small class="d-block text-muted">Cliente asignado directamente, no visible en
                                    catálogo</small>
                            </label>
                        </div>
                    </div>

                    <!-- Selector de Cliente (oculto por defecto) -->
                    <div class="mb-3" id="clienteSelectorContainer" style="display: none;">
                        <label for="clienteId" class="form-label">
                            Cliente Asignado
                            <i class="bi bi-info-circle" data-bs-toggle="tooltip" title="Busca por nombre o email"></i>
                        </label>
                        <select class="form-select" id="clienteId" name="clienteId">
                            <option value="">-- Selecciona un cliente --</option>
                            {{#each clientes}}
                            <option value="{{this.id}}" data-email="{{this.email}}">
                                {{this.nombre}} ({{this.email}})
                            </option>
                            {{/each}}
                        </select>
                        <small class="text-muted">El cliente será notificado automáticamente</small>
                    </div>

                    <hr class="my-4">

                    <!-- Datos de la Reunión -->
                    <div class="mb-3">
                        <label for="titulo" class="form-label">Título *</label>
                        <input type="text" class="form-control" id="titulo" name="titulo"
                            placeholder="Ej: Presentación de Producto X" required>
                    </div>

                    <div class="mb-3">
                        <label for="descripcion" class="form-label">Descripción</label>
                        <textarea class="form-control" id="descripcion" name="descripcion" rows="3"
                            placeholder="Detalles adicionales de la reunión..."></textarea>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="fecha" class="form-label">Fecha *</label>
                            <input type="date" class="form-control" id="fecha" name="fecha" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="hora" class="form-label">Hora *</label>
                            <input type="time" class="form-control" id="hora" name="hora" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="duracion" class="form-label">Duración (minutos)</label>
                        <input type="number" class="form-control" id="duracion" name="duracion" value="60" min="5">
                        <small class="text-muted">Por defecto: 60 minutos</small>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-save"></i> Crear Reunión
                        </button>
                        <a href="/reuniones/gestionar" class="btn btn-secondary">
                            <i class="bi bi-x-circle"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="/js/formulario.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.getElementById('formReunion')
        const fechaInput = document.getElementById('fecha')
        const horaInput = document.getElementById('hora')

        // Establecer fecha minima como hoy
        const hoy = new Date()
        const fechaHoy = hoy.toISOString().split('T')[0]
        fechaInput.setAttribute('min', fechaHoy)

        // Validacion simple
        form.addEventListener('submit', function (e) {
            const fecha = fechaInput.value
            const hora = horaInput.value

            if (!fecha || !hora) return true

            // Crear fecha local (no UTC)
            const fechaHoraCompleta = new Date(`${fecha}T${hora}:00`)
            const ahora = new Date()

            if (fechaHoraCompleta < ahora) {
                e.preventDefault()
                alert('Error: No puedes crear reuniones en el pasado')
                return false
            }

            return true
        })
    })
</script>